{% extends 'base.html' %}
{% block title %}Teller Dashboard - Tobey Finance Bank{% endblock %}
{% block content %}
<div class="container-fluid py-4">
  <!-- Welcome Message Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card bg-gradient-primary text-white shadow">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-8">
              <h4 class="card-title mb-2">
                <i class="fas fa-cash-register me-2"></i>
                Welcome to Teller Operations!
              </h4>
              <h5 class="mb-1">
                {{ current_user.employee.first_name }} {{ current_user.employee.last_name }}
              </h5>
              <p class="card-text mb-2">
                <i class="fas fa-building me-2"></i>{{ current_user.department.value }} | 
                <i class="fas fa-user-tie me-2"></i>{{ current_user.role.value.title() }} Access
              </p>
              <p class="card-text mb-0">
                <i class="fas fa-clock me-2"></i>
                Ready to process transactions and serve customers
              </p>
            </div>
            <div class="col-4 text-end">
              <div class="text-white-50">
                <i class="fas fa-money-bill-wave fa-3x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Status Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-left-success shadow">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                System Status
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">
                <i class="fas fa-check-circle text-success me-2"></i>
                All teller systems operational
              </div>
            </div>
            <div class="col-auto">
              <div class="text-success">
                <i class="fas fa-server fa-2x"></i>
              </div>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-3">
              <small class="text-muted">
                <i class="fas fa-shield-alt me-1"></i>
                Security Level: <span class="font-weight-bold text-success">Active</span>
              </small>
            </div>
            <div class="col-md-3">
              <small class="text-muted">
                <i class="fas fa-clock me-1"></i>
                Session: <span class="font-weight-bold text-info">Active</span>
              </small>
            </div>
            <div class="col-md-3">
              <small class="text-muted">
                <i class="fas fa-exchange-alt me-1"></i>
                Transactions: <span class="font-weight-bold text-primary">Ready</span>
              </small>
            </div>
            <div class="col-md-3">
              <small class="text-muted">
                <i class="fas fa-dollar-sign me-1"></i>
                Cash Drawer: <span class="font-weight-bold text-warning">Available</span>
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-12">
      <h2 class="fw-bold"><i class="fas fa-tools text-primary"></i> Teller Operations</h2>
      <p class="text-muted">A comprehensive workstation for all teller operations.</p>
    </div>
  </div>
  <div class="row g-3 mb-4">
    <!-- Cash Operations -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-primary text-white"><i class="fas fa-money-bill-wave me-2"></i>Cash Operations</div>
        <div class="card-body">
          <button class="btn btn-success mb-2 w-100" onclick="openModal('depositModal')"><i class="fas fa-arrow-down me-2"></i>Deposit</button>
          <button class="btn btn-danger mb-2 w-100" onclick="openModal('withdrawModal')"><i class="fas fa-arrow-up me-2"></i>Withdraw</button>
          <button class="btn btn-info mb-2 w-100" onclick="openModal('cashCountModal')"><i class="fas fa-calculator me-2"></i>Cash Count</button>
          <button class="btn btn-warning mb-2 w-100" onclick="openModal('cashTransferModal')"><i class="fas fa-exchange-alt me-2"></i>Cash Transfer</button>
          <button class="btn btn-secondary mb-2 w-100" onclick="openModal('counterfeitModal')"><i class="fas fa-search-dollar me-2"></i>Counterfeit Detection</button>
        </div>
      </div>
    </div>
    <!-- Check Operations -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-info text-white"><i class="fas fa-money-check me-2"></i>Check Operations</div>
        <div class="card-body">
          <button class="btn btn-success mb-2 w-100" onclick="openModal('checkDepositModal')"><i class="fas fa-plus me-2"></i>Check Deposit</button>
          <button class="btn btn-info mb-2 w-100" onclick="openModal('checkCashingModal')"><i class="fas fa-money-bill me-2"></i>Check Cashing</button>
          <button class="btn btn-warning mb-2 w-100" onclick="openModal('checkVerificationModal')"><i class="fas fa-search me-2"></i>Check Verification</button>
          <button class="btn btn-secondary mb-2 w-100" onclick="openModal('checkStopPaymentModal')"><i class="fas fa-ban me-2"></i>Stop Payment</button>
          <button class="btn btn-dark mb-2 w-100" onclick="openModal('checkImageModal')"><i class="fas fa-camera me-2"></i>Image Capture</button>
        </div>
      </div>
    </div>
    <!-- Account Services -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-success text-white"><i class="fas fa-user-circle me-2"></i>Account Services</div>
        <div class="card-body">
          <button class="btn btn-primary mb-2 w-100" onclick="openModal('newAccountModal')"><i class="fas fa-plus me-2"></i>Open Account</button>
          <button class="btn btn-warning mb-2 w-100" onclick="openModal('accountModificationModal')"><i class="fas fa-edit me-2"></i>Modify Account</button>
          <button class="btn btn-info mb-2 w-100" onclick="openModal('statementModal')"><i class="fas fa-file-alt me-2"></i>Print Statement</button>
          <button class="btn btn-danger mb-2 w-100" onclick="openModal('accountClosureModal')"><i class="fas fa-times me-2"></i>Close Account</button>
          <button class="btn btn-secondary mb-2 w-100" onclick="openModal('accountFreezeModal')"><i class="fas fa-snowflake me-2"></i>Freeze/Unfreeze</button>
        </div>
      </div>
    </div>
    <!-- Customer Services -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-warning text-dark"><i class="fas fa-users me-2"></i>Customer Services</div>
        <div class="card-body">
          <button class="btn btn-primary mb-2 w-100" onclick="openModal('customerLookupModal')"><i class="fas fa-search me-2"></i>Lookup</button>
          <button class="btn btn-info mb-2 w-100" onclick="openModal('kycModal')"><i class="fas fa-id-card me-2"></i>KYC Verification</button>
          <button class="btn btn-success mb-2 w-100" onclick="openModal('customerUpdateModal')"><i class="fas fa-user-edit me-2"></i>Update Info</button>
          <button class="btn btn-secondary mb-2 w-100" onclick="openModal('customerProfileModal')"><i class="fas fa-user me-2"></i>View Profile</button>
        </div>
      </div>
    </div>
    <!-- Card Services -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-secondary text-white"><i class="fas fa-credit-card me-2"></i>Card Services</div>
        <div class="card-body">
          <button class="btn btn-primary mb-2 w-100" onclick="openModal('cardIssueModal')"><i class="fas fa-plus me-2"></i>Issue Card</button>
          <button class="btn btn-warning mb-2 w-100" onclick="openModal('cardReplaceModal')"><i class="fas fa-sync me-2"></i>Replace Card</button>
          <button class="btn btn-danger mb-2 w-100" onclick="openModal('cardBlockModal')"><i class="fas fa-ban me-2"></i>Block Card</button>
          <button class="btn btn-info mb-2 w-100" onclick="openModal('pinChangeModal')"><i class="fas fa-key me-2"></i>PIN Change</button>
          <button class="btn btn-success mb-2 w-100" onclick="openModal('cardActivateModal')"><i class="fas fa-check me-2"></i>Activate Card</button>
        </div>
      </div>
    </div>
    <!-- Payment Services -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-danger text-white"><i class="fas fa-credit-card me-2"></i>Payment Services</div>
        <div class="card-body">
          <button class="btn btn-success mb-2 w-100" onclick="openModal('billPaymentModal')"><i class="fas fa-file-invoice-dollar me-2"></i>Bill Payment</button>
          <button class="btn btn-info mb-2 w-100" onclick="openModal('wireTransferModal')"><i class="fas fa-random me-2"></i>Wire Transfer</button>
          <button class="btn btn-warning mb-2 w-100" onclick="openModal('loanPaymentModal')"><i class="fas fa-university me-2"></i>Loan Payment</button>
          <button class="btn btn-secondary mb-2 w-100" onclick="openModal('utilityPaymentModal')"><i class="fas fa-lightbulb me-2"></i>Utility Payment</button>
          <button class="btn btn-dark mb-2 w-100" onclick="openModal('taxPaymentModal')"><i class="fas fa-file-invoice me-2"></i>Tax Payment</button>
        </div>
      </div>
    </div>
    <!-- Foreign Exchange -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-dark text-white"><i class="fas fa-exchange-alt me-2"></i>Foreign Exchange</div>
        <div class="card-body">
          <button class="btn btn-warning mb-2 w-100" onclick="openModal('currencyExchangeModal')"><i class="fas fa-coins me-2"></i>Currency Exchange</button>
          <button class="btn btn-info mb-2 w-100" onclick="openModal('exchangeRatesModal')"><i class="fas fa-chart-line me-2"></i>View Rates</button>
        </div>
      </div>
    </div>
    <!-- Fraud & Compliance -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-warning text-dark"><i class="fas fa-shield-alt me-2"></i>Fraud & Compliance</div>
        <div class="card-body">
          <button class="btn btn-danger mb-2 w-100" onclick="openModal('fraudReportModal')"><i class="fas fa-exclamation-triangle me-2"></i>Report Fraud</button>
          <button class="btn btn-secondary mb-2 w-100" onclick="openModal('regulatoryReportModal')"><i class="fas fa-balance-scale me-2"></i>Regulatory Report</button>
        </div>
      </div>
    </div>
    <!-- Reporting -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-info text-white"><i class="fas fa-chart-bar me-2"></i>Reporting</div>
        <div class="card-body">
          <button class="btn btn-primary mb-2 w-100" onclick="openModal('transactionReportModal')"><i class="fas fa-list-alt me-2"></i>Transaction Report</button>
          <button class="btn btn-success mb-2 w-100" onclick="openModal('cashflowReportModal')"><i class="fas fa-water me-2"></i>Cashflow Report</button>
          <button class="btn btn-secondary mb-2 w-100" onclick="openModal('auditLogModal')"><i class="fas fa-clipboard-list me-2"></i>Audit Logs</button>
        </div>
      </div>
    </div>
    <!-- Quick Access -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-secondary text-white"><i class="fas fa-bolt me-2"></i>Quick Access</div>
        <div class="card-body">
          <button class="btn btn-info mb-2 w-100" onclick="openModal('recentTransactionsModal')"><i class="fas fa-history me-2"></i>Recent Transactions</button>
          <button class="btn btn-warning mb-2 w-100" onclick="openModal('favoritesModal')"><i class="fas fa-star me-2"></i>Favorites</button>
          <button class="btn btn-danger mb-2 w-100" onclick="openModal('alertsModal')"><i class="fas fa-bell me-2"></i>Alerts</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Transaction Table -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="fas fa-list-alt text-primary"></i> Teller Transactions</h5>
          <div>
            <input type="text" id="searchTransactions" class="form-control form-control-sm d-inline-block w-auto" placeholder="Search...">
          </div>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive" style="max-height: 400px;">
            <table class="table table-hover table-striped align-middle mb-0" id="tellerTransactionsTable">
              <thead class="table-primary sticky-top">
                <tr>
                  <th>Date</th>
                  <th>Type</th>
                  <th>Account</th>
                  <th>Customer</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody id="tellerTransactionsBody">
                <!-- Transactions will be populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Cash Deposit Modal (real logic) -->
<div class="modal fade" id="depositModal" tabindex="-1" aria-labelledby="depositModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="depositModalLabel"><i class="fas fa-arrow-down text-success"></i> Cash Deposit</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="depositForm">
        <div class="modal-body">
          <div id="depositAlert"></div>
          <div class="mb-3">
            <label for="depositAccount" class="form-label">Account Number</label>
            <input type="text" class="form-control" id="depositAccount" name="account_number" required autocomplete="off">
          </div>
          <div class="mb-3">
            <label for="depositAmount" class="form-label">Amount</label>
            <input type="number" class="form-control" id="depositAmount" name="amount" min="1" step="0.01" required>
          </div>
          <div class="mb-3">
            <label for="depositCurrency" class="form-label">Currency</label>
            <select class="form-select" id="depositCurrency" name="currency">
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="GBP">GBP</option>
              <option value="NGN">NGN</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="depositDescription" class="form-label">Description</label>
            <input type="text" class="form-control" id="depositDescription" name="description" maxlength="100">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Deposit</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Cash Withdrawal Modal (real logic) -->
<div class="modal fade" id="withdrawModal" tabindex="-1" aria-labelledby="withdrawModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="withdrawModalLabel"><i class="fas fa-arrow-up text-danger"></i> Cash Withdrawal</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="withdrawForm">
        <div class="modal-body">
          <div id="withdrawAlert"></div>
          <div class="mb-3">
            <label for="withdrawAccount" class="form-label">Account Number</label>
            <input type="text" class="form-control" id="withdrawAccount" name="account_number" required autocomplete="off">
          </div>
          <div class="mb-3">
            <label for="withdrawAmount" class="form-label">Amount</label>
            <input type="number" class="form-control" id="withdrawAmount" name="amount" min="1" step="0.01" required>
          </div>
          <div class="mb-3">
            <label for="withdrawCurrency" class="form-label">Currency</label>
            <select class="form-select" id="withdrawCurrency" name="currency">
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="GBP">GBP</option>
              <option value="NGN">NGN</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="withdrawDescription" class="form-label">Description</label>
            <input type="text" class="form-control" id="withdrawDescription" name="description" maxlength="100">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-danger">Withdraw</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Check Deposit Modal (real logic) -->
<div class="modal fade" id="checkDepositModal" tabindex="-1" aria-labelledby="checkDepositModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="checkDepositModalLabel"><i class="fas fa-money-check-alt text-info"></i> Check Deposit</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="checkDepositForm">
        <div class="modal-body">
          <div id="checkDepositAlert"></div>
          <div class="mb-3">
            <label for="checkDepositAccount" class="form-label">Account Number</label>
            <input type="text" class="form-control" id="checkDepositAccount" name="account_number" required autocomplete="off">
          </div>
          <div class="mb-3">
            <label for="checkDepositAmount" class="form-label">Amount</label>
            <input type="number" class="form-control" id="checkDepositAmount" name="amount" min="1" step="0.01" required>
          </div>
          <div class="mb-3">
            <label for="checkDepositCurrency" class="form-label">Currency</label>
            <select class="form-select" id="checkDepositCurrency" name="currency">
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="GBP">GBP</option>
              <option value="NGN">NGN</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="checkNumber" class="form-label">Check Number</label>
            <input type="text" class="form-control" id="checkNumber" name="check_number" required maxlength="20">
          </div>
          <div class="mb-3">
            <label for="checkDepositDescription" class="form-label">Description</label>
            <input type="text" class="form-control" id="checkDepositDescription" name="description" maxlength="100">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-info">Deposit Check</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Customer Lookup Modal (real logic) -->
<div class="modal fade" id="customerLookupModal" tabindex="-1" aria-labelledby="customerLookupModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="customerLookupModalLabel"><i class="fas fa-search text-primary"></i> Customer Lookup</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="customerLookupForm">
        <div class="modal-body">
          <div id="customerLookupAlert"></div>
          <div class="mb-3">
            <label for="lookupInput" class="form-label">Search by name, account, or phone</label>
            <input type="text" class="form-control" id="lookupInput" name="query" placeholder="Enter name, account, or phone..." required>
          </div>
          <div class="table-responsive" style="max-height: 300px;">
            <table class="table table-hover align-middle mb-0" id="lookupTable">
              <thead class="table-light">
                <tr>
                  <th>Name</th>
                  <th>Account</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="lookupBody">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Search</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Account Freeze/Unfreeze Modal (real logic) -->
<div class="modal fade" id="accountFreezeModal" tabindex="-1" aria-labelledby="accountFreezeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="accountFreezeModalLabel"><i class="fas fa-snowflake text-secondary"></i> Freeze/Unfreeze Account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="accountFreezeForm">
        <div class="modal-body">
          <div id="accountFreezeAlert"></div>
          <div class="mb-3">
            <label for="freezeAccount" class="form-label">Account Number</label>
            <input type="text" class="form-control" id="freezeAccount" name="account_number" required autocomplete="off">
          </div>
          <div class="mb-3">
            <label for="freezeAction" class="form-label">Action</label>
            <select class="form-select" id="freezeAction" name="action">
              <option value="freeze">Freeze</option>
              <option value="unfreeze">Unfreeze</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="freezeReason" class="form-label">Reason</label>
            <input type="text" class="form-control" id="freezeReason" name="reason" required maxlength="100">
          </div>
          <div class="mb-3">
            <label for="freezeDescription" class="form-label">Description</label>
            <input type="text" class="form-control" id="freezeDescription" name="description" maxlength="100">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-secondary">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Card Issue Modal (real logic) -->
<div class="modal fade" id="cardIssueModal" tabindex="-1" aria-labelledby="cardIssueModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="cardIssueModalLabel"><i class="fas fa-credit-card text-primary"></i> Issue Card</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="cardIssueForm">
        <div class="modal-body">
          <div id="cardIssueAlert"></div>
          <div class="mb-3">
            <label for="cardAccount" class="form-label">Account Number</label>
            <input type="text" class="form-control" id="cardAccount" name="account_number" required autocomplete="off">
          </div>
          <div class="mb-3">
            <label for="cardType" class="form-label">Card Type</label>
            <select class="form-select" id="cardType" name="card_type">
              <option value="Visa">Visa</option>
              <option value="Mastercard">Mastercard</option>
              <option value="Verve">Verve</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="cardHolder" class="form-label">Cardholder Name</label>
            <input type="text" class="form-control" id="cardHolder" name="cardholder_name" required maxlength="50">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Issue Card</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Wire Transfer Modal (real logic) -->
<div class="modal fade" id="wireTransferModal" tabindex="-1" aria-labelledby="wireTransferModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="wireTransferModalLabel"><i class="fas fa-random text-info"></i> Wire Transfer</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="wireTransferForm">
        <div class="modal-body">
          <div id="wireTransferAlert"></div>
          <div class="mb-3">
            <label for="wireFromAccount" class="form-label">From Account</label>
            <input type="text" class="form-control" id="wireFromAccount" name="from_account" required autocomplete="off">
          </div>
          <div class="mb-3">
            <label for="wireToAccount" class="form-label">To Account</label>
            <input type="text" class="form-control" id="wireToAccount" name="to_account" required autocomplete="off">
          </div>
          <div class="mb-3">
            <label for="wireAmount" class="form-label">Amount</label>
            <input type="number" class="form-control" id="wireAmount" name="amount" min="1" step="0.01" required>
          </div>
          <div class="mb-3">
            <label for="wireCurrency" class="form-label">Currency</label>
            <select class="form-select" id="wireCurrency" name="currency">
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="GBP">GBP</option>
              <option value="NGN">NGN</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="wireDescription" class="form-label">Description</label>
            <input type="text" class="form-control" id="wireDescription" name="description" maxlength="100">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-info">Transfer</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Currency Exchange Modal (real logic) -->
<div class="modal fade" id="currencyExchangeModal" tabindex="-1" aria-labelledby="currencyExchangeModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="currencyExchangeModalLabel"><i class="fas fa-coins text-warning"></i> Currency Exchange</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="currencyExchangeForm">
        <div class="modal-body">
          <div id="currencyExchangeAlert"></div>
          <div class="mb-3">
            <label for="exchangeAccount" class="form-label">Account Number</label>
            <input type="text" class="form-control" id="exchangeAccount" name="account_number" required autocomplete="off">
          </div>
          <div class="mb-3">
            <label for="fromCurrency" class="form-label">From Currency</label>
            <select class="form-select" id="fromCurrency" name="from_currency">
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="GBP">GBP</option>
              <option value="NGN">NGN</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="toCurrency" class="form-label">To Currency</label>
            <select class="form-select" id="toCurrency" name="to_currency">
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="GBP">GBP</option>
              <option value="NGN">NGN</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="exchangeAmount" class="form-label">Amount</label>
            <input type="number" class="form-control" id="exchangeAmount" name="amount" min="1" step="0.01" required>
          </div>
          <div class="mb-3">
            <label for="exchangeDescription" class="form-label">Description</label>
            <input type="text" class="form-control" id="exchangeDescription" name="description" maxlength="100">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-warning">Exchange</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Fraud Report Modal (real logic) -->
<div class="modal fade" id="fraudReportModal" tabindex="-1" aria-labelledby="fraudReportModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="fraudReportModalLabel"><i class="fas fa-exclamation-triangle text-danger"></i> Report Fraud</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="fraudReportForm">
        <div class="modal-body">
          <div id="fraudReportAlert"></div>
          <div class="mb-3">
            <label for="fraudAccount" class="form-label">Account Number</label>
            <input type="text" class="form-control" id="fraudAccount" name="account_number" required autocomplete="off">
          </div>
          <div class="mb-3">
            <label for="fraudType" class="form-label">Fraud Type</label>
            <select class="form-select" id="fraudType" name="fraud_type">
              <option value="Identity Theft">Identity Theft</option>
              <option value="Account Takeover">Account Takeover</option>
              <option value="Check Fraud">Check Fraud</option>
              <option value="Card Fraud">Card Fraud</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="fraudDescription" class="form-label">Description</label>
            <textarea class="form-control" id="fraudDescription" name="description" maxlength="300" rows="3" required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-danger">Report</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Other modals remain as placeholders for now -->
{% for modal in [
  'cashCountModal','cashTransferModal','counterfeitModal',
  'checkCashingModal','checkVerificationModal','checkStopPaymentModal','checkImageModal',
  'newAccountModal','accountModificationModal','statementModal','accountClosureModal',
  'customerUpdateModal','customerProfileModal',
  'cardReplaceModal','cardBlockModal','pinChangeModal','cardActivateModal',
  'billPaymentModal','loanPaymentModal','utilityPaymentModal','taxPaymentModal',
  'exchangeRatesModal','regulatoryReportModal',
  'transactionReportModal','cashflowReportModal','auditLogModal',
  'recentTransactionsModal','favoritesModal','alertsModal'
] %}
<div class="modal fade" id="{{ modal }}" tabindex="-1" aria-labelledby="{{ modal }}Label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="{{ modal }}Label">{{ modal|replace('Modal','')|replace('_',' ')|title }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Form for {{ modal|replace('Modal','')|replace('_',' ')|title }} goes here.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Submit</button>
      </div>
    </div>
  </div>
</div>
{% endfor %}

<script>
function openModal(modalId) {
  var modal = document.getElementById(modalId);
  if (modal) {
    var bsModal = new bootstrap.Modal(modal);
    bsModal.show();
  }
}

document.addEventListener('DOMContentLoaded', function() {
  // Helper for AJAX form submission
  function handleForm(formId, alertId, endpoint, transformData) {
    const form = document.getElementById(formId);
    if (form) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        const alertBox = document.getElementById(alertId);
        alertBox.innerHTML = '';
        let data = {};
        new FormData(form).forEach((v, k) => data[k] = v);
        if (transformData) data = transformData(data);
        try {
          const resp = await fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          const result = await resp.json();
          if (result.success || result.message || result.transaction_id) {
            alertBox.innerHTML = `<div class="alert alert-success">${result.message || 'Success.'}</div>`;
            form.reset();
            setTimeout(() => {
              var modal = bootstrap.Modal.getInstance(document.getElementById(formId.replace('Form','Modal')));
              if (modal) modal.hide();
            }, 1200);
          } else {
            alertBox.innerHTML = `<div class="alert alert-danger">${result.error || result.message || 'Operation failed.'}</div>`;
          }
        } catch (err) {
          alertBox.innerHTML = '<div class="alert alert-danger">Error processing request.</div>';
        }
      });
    }
  }
  // Cash Deposit
  handleForm('depositForm', 'depositAlert', '/api/teller/deposit');
  // Cash Withdrawal
  handleForm('withdrawForm', 'withdrawAlert', '/api/teller/withdraw');
  // Check Deposit
  handleForm('checkDepositForm', 'checkDepositAlert', '/api/teller/check/deposit');
  // Account Freeze/Unfreeze
  handleForm('accountFreezeForm', 'accountFreezeAlert', function(data) {
    return data.action === 'freeze' ? '/api/teller/account/freeze' : '/api/teller/account/unfreeze';
  }, function(data) {
    // If transformData is a function, it will be called with data
    return data;
  });
  // Card Issue
  handleForm('cardIssueForm', 'cardIssueAlert', '/api/teller/card/issue');
  // Wire Transfer
  handleForm('wireTransferForm', 'wireTransferAlert', '/api/teller/wire/transfer');
  // Currency Exchange
  handleForm('currencyExchangeForm', 'currencyExchangeAlert', '/api/teller/currency/exchange');
  // Fraud Report
  handleForm('fraudReportForm', 'fraudReportAlert', '/api/teller/fraud/report');

  // Customer Lookup (special: show results in table)
  const customerLookupForm = document.getElementById('customerLookupForm');
  if (customerLookupForm) {
    customerLookupForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const alertBox = document.getElementById('customerLookupAlert');
      alertBox.innerHTML = '';
      const query = document.getElementById('lookupInput').value;
      if (!query) {
        alertBox.innerHTML = '<div class="alert alert-danger">Please enter a search query.</div>';
        return;
      }
      try {
        const resp = await fetch('/api/teller/customer/search', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query })
        });
        const result = await resp.json();
        if (result.success && result.customers) {
          let html = '';
          result.customers.forEach(c => {
            html += `<tr><td>${c.name}</td><td>${c.account}</td><td>${c.email}</td><td>${c.phone}</td><td>${c.status}</td></tr>`;
          });
          document.getElementById('lookupBody').innerHTML = html;
        } else {
          alertBox.innerHTML = `<div class="alert alert-warning">No customers found.</div>`;
          document.getElementById('lookupBody').innerHTML = '';
        }
      } catch (err) {
        alertBox.innerHTML = '<div class="alert alert-danger">Error searching for customers.</div>';
      }
    });
  }
});
</script>
{% endblock %} 